<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u - Salud App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #4A7FFF 0%, #5B8FFF 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(180deg, #4A7FFF 0%, #5B8FFF 100%);
            padding: 40px 30px;
            text-align: center;
            color: white;
        }

        .logo {
            width: 170px;
            height: 150px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: brightness(0) invert(1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 500;
        }

        .content {
            padding: 40px 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            outline: none;
        }

        input:focus {
            border-color: #4A7FFF;
            box-shadow: 0 0 0 3px rgba(74, 127, 255, 0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: #4A7FFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(74, 127, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 127, 255, 0.4);
            background: #3D6FEE;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.error {
            background: #FEE2E2;
            color: #991B1B;
            border: 1px solid #FCA5A5;
            display: block;
            font-weight: 500;
        }

        .password-requirements {
            font-size: 13px;
            color: #6B7280;
            margin-top: 8px;
            padding-left: 20px;
        }

        .password-requirements li {
            margin: 4px 0;
        }

        .footer {
            text-align: center;
            padding: 20px 30px;
            background: #F9FAFB;
            color: #6B7280;
            font-size: 14px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .password-toggle {
            position: relative;
        }

        .password-toggle input {
            padding-right: 45px;
        }

        .toggle-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(calc(-50% + 12px));
            background: transparent;
            border: none;
            cursor: pointer;
            color: #9CA3AF;
            padding: 8px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 6px;
        }

        .toggle-btn:hover {
            background: #F3F4F6;
            color: #4A7FFF;
        }

        .toggle-btn svg {
            width: 20px;
            height: 20px;
        }

        /* SUCCESS SCREEN STYLES */
        .success-screen {
            display: none;
            text-align: center;
            padding: 60px 30px;
        }

        .success-screen.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .success-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            animation: bounceIn 0.6s ease;
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.3);
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .success-icon svg {
            width: 60px;
            height: 60px;
            color: white;
            animation: checkmark 0.5s ease 0.3s both;
        }

        @keyframes checkmark {
            0% { stroke-dashoffset: 100; opacity: 0; }
            100% { stroke-dashoffset: 0; opacity: 1; }
        }

        .success-title {
            font-size: 28px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 15px;
        }

        .success-message {
            font-size: 16px;
            color: #6B7280;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .success-message strong {
            color: #10B981;
        }

        .success-tips {
            background: #F0FDF4;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            margin-bottom: 30px;
            border: 1px solid #BBF7D0;
        }

        .success-tips h3 {
            font-size: 14px;
            color: #166534;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .success-tips ul {
            font-size: 13px;
            color: #15803D;
            padding-left: 20px;
        }

        .success-tips li {
            margin: 6px 0;
        }

        .app-badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .app-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #1F2937;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .app-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .app-badge svg {
            width: 24px;
            height: 24px;
        }

        .app-badge span {
            font-size: 14px;
            font-weight: 600;
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1000;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #4A7FFF;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- RESET PASSWORD SCREEN -->
        <div id="resetScreen">
            <div class="header">
                <div class="logo">
                    <img src="https://raw.githubusercontent.com/uthprj/Salud_App/main/app/src/main/res/drawable/salud_logo.png" alt="Salud Logo">
                </div>
                <h1>ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</h1>
                <p>Salud App - S·ª©c kh·ªèe c·ªßa b·∫°n l√† ni·ªÅm vui c·ªßa ch√∫ng t√¥i</p>
            </div>

            <div class="content">
                <div id="errorMessage" class="message error"></div>

                <form id="resetForm">
                    <div class="form-group password-toggle">
                        <label for="newPassword">M·∫≠t kh·∫©u m·ªõi</label>
                        <input 
                            type="password" 
                            id="newPassword" 
                            name="newPassword" 
                            placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi"
                            required
                            minlength="6"
                        >
                        <button type="button" class="toggle-btn" id="toggleNewPassword" onclick="togglePassword('newPassword')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>

                    <div class="form-group password-toggle">
                        <label for="confirmPassword">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            name="confirmPassword" 
                            placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"
                            required
                            minlength="6"
                        >
                        <button type="button" class="toggle-btn" id="toggleConfirmPassword" onclick="togglePassword('confirmPassword')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>

                    <div id="passwordMismatch" style="display: none; color: #DC2626; font-size: 14px; margin-top: -15px; margin-bottom: 15px; padding: 10px; background: #FEE2E2; border-radius: 8px; border-left: 3px solid #DC2626;">
                        M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!
                    </div>

                    <ul class="password-requirements">
                        <li>‚úì √çt nh·∫•t 6 k√Ω t·ª±</li>
                        <li>‚úì N√™n bao g·ªìm ch·ªØ hoa, ch·ªØ th∆∞·ªùng v√† s·ªë</li>
                        <li>‚úì Kh√¥ng s·ª≠ d·ª•ng m·∫≠t kh·∫©u d·ªÖ ƒëo√°n</li>
                    </ul>

                    <button type="submit" class="btn" id="submitBtn">
                        ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u
                    </button>
                </form>
            </div>

            <div class="footer">
                ¬© 2025 Salud App. All rights reserved.
            </div>
        </div>

        <!-- SUCCESS SCREEN -->
        <div id="successScreen" class="success-screen">
            <div class="success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            
            <h2 class="success-title">Th√†nh c√¥ng! üéâ</h2>
            
            <p class="success-message">
                M·∫≠t kh·∫©u c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c <strong>ƒë·∫∑t l·∫°i th√†nh c√¥ng</strong>.<br>
                B√¢y gi·ªù b·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p v√†o ·ª©ng d·ª•ng v·ªõi m·∫≠t kh·∫©u m·ªõi.
            </p>

            <div class="success-tips">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    B∆∞·ªõc ti·∫øp theo
                </h3>
                <ul>
                    <li>M·ªü ·ª©ng d·ª•ng <strong>Salud App</strong> tr√™n ƒëi·ªán tho·∫°i</li>
                    <li>ƒêƒÉng nh·∫≠p b·∫±ng email v√† m·∫≠t kh·∫©u m·ªõi</li>
                    <li>T·∫≠n h∆∞·ªüng h√†nh tr√¨nh s·ª©c kh·ªèe c·ªßa b·∫°n! üí™</li>
                </ul>
            </div>

            <!-- <div class="app-badges">
                <div class="app-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.523 2.047a.5.5 0 0 0-.738-.238L12 4.756 7.215 1.809a.5.5 0 0 0-.738.238L4.47 6.291a.5.5 0 0 0 .19.594l4.085 2.738v10.877a.5.5 0 0 0 .755.431L12 19.438l2.5 1.493a.5.5 0 0 0 .755-.431V9.623l4.085-2.738a.5.5 0 0 0 .19-.594l-2.007-4.244z"/>
                    </svg>
                </div>
            </div> -->
        </div>
    </div>

    <!-- Confetti container -->
    <div id="confetti" class="confetti"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDZ_pYYTR0GiQl5jhmpL3W4gUphCIGTp1o",
            authDomain: "salud-app-263a5.firebaseapp.com",
            projectId: "salud-app-263a5",
            storageBucket: "salud-app-263a5.firebasestorage.app",
            messagingSenderId: "718456115746",
            appId: "1:718456115746:android:d117a2f6560654011e307b"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = document.getElementById('toggle' + inputId.charAt(0).toUpperCase() + inputId.slice(1));
            const isPassword = input.type === 'password';
            
            input.type = isPassword ? 'text' : 'password';
            
            if (isPassword) {
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                `;
            } else {
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                        <line x1="1" y1="1" x2="23" y2="23"></line>
                    </svg>
                `;
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = '‚úó ' + message;
            errorDiv.style.display = 'block';
        }

        function createConfetti() {
            const confettiContainer = document.getElementById('confetti');
            const colors = ['#4A7FFF', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899'];
            
            for (let i = 0; i < 50; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + '%';
                piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = Math.random() * 2 + 's';
                piece.style.animationDuration = (Math.random() * 2 + 2) + 's';
                confettiContainer.appendChild(piece);
            }

            setTimeout(() => {
                confettiContainer.innerHTML = '';
            }, 5000);
        }

        function showSuccess() {
            document.getElementById('resetScreen').style.display = 'none';
            document.getElementById('successScreen').classList.add('show');
            createConfetti();
        }

        function setLoading(isLoading) {
            const btn = document.getElementById('submitBtn');
            if (isLoading) {
                btn.disabled = true;
                btn.innerHTML = '<span class="spinner"></span>ƒêang x·ª≠ l√Ω...';
            } else {
                btn.disabled = false;
                btn.innerHTML = 'ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u';
            }
        }

        const urlParams = new URLSearchParams(window.location.search);
        const oobCode = urlParams.get('oobCode');

        if (!oobCode) {
            showError('Link kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n. Vui l√≤ng y√™u c·∫ßu ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u m·ªõi.');
            document.getElementById('resetForm').style.display = 'none';
        }

        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const mismatchDiv = document.getElementById('passwordMismatch');

        function checkPasswordMatch() {
            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (confirmPassword.length > 0 && newPassword !== confirmPassword) {
                mismatchDiv.style.display = 'block';
                confirmPasswordInput.style.borderColor = '#DC2626';
            } else {
                mismatchDiv.style.display = 'none';
                confirmPasswordInput.style.borderColor = '#E5E7EB';
            }
        }

        newPasswordInput.addEventListener('input', checkPasswordMatch);
        confirmPasswordInput.addEventListener('input', checkPasswordMatch);

        document.getElementById('resetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword !== confirmPassword) {
                showError('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');
                return;
            }

            if (newPassword.length < 6) {
                showError('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
                return;
            }

            setLoading(true);

            try {
                await auth.confirmPasswordReset(oobCode, newPassword);
                showSuccess();
            } catch (error) {
                console.error(error);
                let errorMessage = 'C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.';
                
                switch(error.code) {
                    case 'auth/expired-action-code':
                        errorMessage = 'Link ƒë√£ h·∫øt h·∫°n. Vui l√≤ng y√™u c·∫ßu ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u m·ªõi.';
                        break;
                    case 'auth/invalid-action-code':
                        errorMessage = 'Link kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'M·∫≠t kh·∫©u qu√° y·∫øu. Vui l√≤ng ch·ªçn m·∫≠t kh·∫©u m·∫°nh h∆°n.';
                        break;
                }
                
                showError(errorMessage);
            } finally {
                setLoading(false);
            }
        });
    </script>
</body>
</html>
